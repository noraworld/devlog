---
title: "Heroku ã® postdeploy ãŒå‹•ä½œã—ãªã„åŸå› "
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Heroku"]
published: true
order: 130
layout: article
---

# ä¸€è¨€ã§ã‚ã‹ã‚‹çµè«–
**[`postdeploy` ã¯ã‚¢ãƒ—ãƒªã®ä½œæˆå¾Œã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹ï¼](https://devcenter.heroku.com/ja/articles/github-integration-review-apps#:~:text=postdeploy%20%E3%81%AF%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%E4%BD%9C%E6%88%90%E5%BE%8C%E3%81%AB%E4%B8%80%E5%BA%A6%E3%81%A0%E3%81%91%E5%AE%9F%E8%A1%8C%E3%81%95%E3%82%8C%E3%82%8B)**

ã“ã‚Œã§ã™ã¹ã¦ã‚’ç†è§£ã—ãŸå ´åˆã¯ã€ã“ã‚Œã‚ˆã‚Šå…ˆã¯èª­ã¾ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã€‚




# åŸå› ã¨ç†ç”±
Heroku ã§ã¯ã€ãƒªãƒã‚¸ãƒˆãƒªãƒ«ãƒ¼ãƒˆã« `app.json` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ãã®ä¸­ã«ã„ã‚ã„ã‚è¨˜è¿°ã™ã‚‹ã“ã¨ã§ Heroku ä¸Šã§ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

ãã®ä¸­ã« `postdeploy` ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚‹ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€Heroku ä¸Šã§ã‚¢ãƒ—ãƒªãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã¨ãã«ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚

```json:app.json
{
  // çœç•¥
  "scripts": {
    "postdeploy": "RAILS_ENV=production bundle exec rails db:create && RAILS_ENV=production bundle exec rails db:migrate && RAILS_ENV=production bundle exec rails assets:precompile"
  }
  // çœç•¥
}
```

ä¸Šè¨˜ã®ä¾‹ã§ã¯ã€Rails ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ–°è¦ä½œæˆã—ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã€ã‚¢ã‚»ãƒƒãƒˆã®ãƒ—ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã€‚

ã“ã®ã‚ˆã†ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã«ä»»æ„ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã§ãã‚‹ä¾¿åˆ©ãªä»•çµ„ã¿ãªã®ã ãŒã€ã„ãã‚‰ `app.json` ã‚’æ›¸ãç›´ã—ã¦ã‚‚å‹•ä½œã—ãªã„ã€‚

ãã®ç†ç”±ã¯ã€**`postdeploy` ã¯ã‚¢ãƒ—ãƒªã®ä½œæˆå¾Œã«ä¸€åº¦ã ã‘ã—ã‹å®Ÿè¡Œã•ã‚Œãªã„ã‹ã‚‰ã§ã‚ã‚‹**ã€‚ã¤ã¾ã‚Šã€ä¸€åº¦ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã‹ã‚‰ `app.json` ã‚’æ›¸ãæ›ãˆã¦ã‚‚ã€ãã®å†…å®¹ã¯åæ˜ ã•ã‚Œãªã„ã¨ã„ã†ã“ã¨ã€‚

å¤‰æ›´ã‚’åæ˜ ã•ã›ãŸã„å ´åˆã¯ã€ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ç›´ã™å¿…è¦ãŒã‚ã‚‹ã€‚Review apps ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã€[ä¸€åº¦ PR ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¦å†ã‚ªãƒ¼ãƒ—ãƒ³ã™ã‚‹ã“ã¨ã§ã‚¢ãƒ—ãƒªã‚’å†ä½œæˆã™ã‚‹ã“ã¨ãŒã§ãã‚‹](https://devcenter.heroku.com/ja/articles/github-integration-review-apps#:~:text=%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AE%20postdeploy%E2%80%8B%20%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%86%8D%E5%AE%9F%E8%A1%8C%E3%81%99%E3%82%8B%E3%81%AB%E3%81%AF%E3%80%81%E3%83%97%E3%83%AB%E3%83%AA%E3%82%AF%E3%82%A8%E3%82%B9%E3%83%88%E3%82%92%E3%82%AF%E3%83%AD%E3%83%BC%E3%82%BA%E3%81%97%E3%81%A6%E5%86%8D%E5%BA%A6%E3%82%AA%E3%83%BC%E3%83%97%E3%83%B3%E3%81%99%E3%82%8B%E5%BF%85%E8%A6%81%E3%81%8C%E3%81%82%E3%82%8A%E3%81%BE%E3%81%99%E3%80%82%E3%81%9D%E3%81%86%E3%81%99%E3%82%8B%E3%81%A8%E3%80%81Heroku%20%E3%81%AB%E3%82%88%E3%81%A3%E3%81%A6%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%82%A2%E3%83%97%E3%83%AA%E3%81%8C%E7%A0%B4%E6%A3%84%E3%81%95%E3%82%8C%E3%80%81%E5%86%8D%E4%BD%9C%E6%88%90%E3%81%95%E3%82%8C%E3%81%BE%E3%81%99%E3%80%82)ã€‚




# ä½™è«‡
ã¡ãªã¿ã«ã€`https://dashboard.heroku.com/apps/<APP_NAME>/app-json` ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€`Output` ã¨ã„ã†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã« JSON ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã€‚

ã“ã®ç”»é¢ã«ã‚ã‚‹ JSON ã¯ã€`app.json` ã«ä¼¼ã¦éãªã‚‹ã‚‚ã®ã§ã‚ã‚‹ã‚ˆã†ã ã€‚

| Heroku ç”»é¢ã® `Output` |
| --- |
| ![](https://raw.githubusercontent.com/noraworld/developers-blog-media-ja/master/heroku-postdeploy-runs-only-once/Screen%20Shot%202022-03-10%20at%2020.11.55.png) |

| `app.json` |
| --- |
| ![](https://raw.githubusercontent.com/noraworld/developers-blog-media-ja/master/heroku-postdeploy-runs-only-once/Screen%20Shot%202022-03-10%20at%2020.13.06.png) |

ã“ã®ç”»é¢ä¸Šã® JSON ã® `"scripts"` ã®ä¸­èº«ãŒç©º (`{}`) ã«ãªã£ã¦ã„ãŸã¨ã—ã¦ã‚‚ã€`app.json` ã§æ­£ã—ãè¨˜è¿°ã•ã‚Œã¦ãŠã‚Šã€ã‹ã¤ã€ã‚¢ãƒ—ãƒªã®åˆå›ä½œæˆæ™‚ã§ã‚ã‚Œã°ã€`"scripts"` (`"postdeploy"`) ã®ä¸­èº«ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã‚‹ã¯ãšã ã€‚







# å‚è€ƒã‚µã‚¤ãƒˆ
* [ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ—ãƒª (æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³)](https://devcenter.heroku.com/ja/articles/github-integration-review-apps)
